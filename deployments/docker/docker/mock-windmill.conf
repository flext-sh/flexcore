server {
    listen 8000;
    server_name localhost;

    # Mock Windmill API endpoints
    
    # Version endpoint
    location /api/version {
        add_header Content-Type application/json;
        return 200 '{"version":"mock-1.0.0","build":"mock"}';
    }
    
    # Flows endpoint (for workflow registration)
    location /api/w/default/flows {
        add_header Content-Type application/json;
        if ($request_method = POST) {
            return 201 '{"path":"mock-workflow-123","workspace_id":"default","summary":"Mock workflow","description":"","schema":{},"extra_perms":{},"archived":false,"draft_only":false,"tag":"","lock":"","is_template":false,"ws_error_handler_muted":false,"priority":0,"concurrent_limit":null,"concurrency_time_window_s":null,"cache_ttl":null,"dedupe_key":"","timeout":null,"delete_after_use":false,"visible_to_runner_only":false}';
        }
        return 200 '{"flows":[]}';
    }
    
    # Jobs run endpoint (for job execution) 
    location ~* /api/w/default/jobs/run/ {
        add_header Content-Type application/json;
        if ($request_method = POST) {
            return 201 '"mock-job-123"';
        }
        return 200 '{"jobs":[]}';
    }
    
    # Job details endpoint
    location ~* /api/w/default/jobs/(.*) {
        add_header Content-Type application/json;
        return 200 '{"id":"$1","workspace_id":"default","parent_job":null,"created_by":"mock","created_at":"2025-07-01T14:00:00Z","started_at":"2025-07-01T14:00:01Z","completed_at":"2025-07-01T14:00:02Z","job_kind":"flow","script_hash":null,"script_path":"mock/path","args":{},"result":{"status":"completed","leader_id":"node-1"},"logs":"Mock job completed","running":false,"scheduled_for":"2025-07-01T14:00:00Z","tag":"flexcore-cluster","flow_status":null,"raw_code":null,"raw_lock":null,"language":"typescript","is_skipped":false,"is_flow_step":false,"same_worker":false}';
    }
    
    # Health check
    location /health {
        add_header Content-Type application/json;
        return 200 '{"status":"healthy","service":"mock-windmill"}';
    }
    
    # Catch-all for other API endpoints
    location /api/ {
        add_header Content-Type application/json;
        return 200 '{"message":"mock response","endpoint":"$uri"}';
    }
}