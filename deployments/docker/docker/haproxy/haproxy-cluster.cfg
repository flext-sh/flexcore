global
    daemon
    log stdout local0 info
    
defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option httplog
    log global

# Statistics page
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s
    stats REDACTED_LDAP_BIND_PASSWORD if TRUE

# FlexCore Cluster Frontend
frontend flexcore_cluster
    bind *:8080
    option httplog
    default_backend flexcore_nodes

# FlexCore Nodes Backend
backend flexcore_nodes
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    
    server node1 flexcore-node1:8001 check inter 10s fall 3 rise 2
    server node2 flexcore-node2:8002 check inter 10s fall 3 rise 2
    server node3 flexcore-node3:8003 check inter 10s fall 3 rise 2

# Leader-only endpoints (for REDACTED_LDAP_BIND_PASSWORD operations)
frontend flexcore_leader
    bind *:8081
    option httplog
    default_backend flexcore_leader_node

backend flexcore_leader_node
    option httpchk GET /health
    http-check expect status 200
    
    # Route REDACTED_LDAP_BIND_PASSWORD operations to leader candidate
    server leader flexcore-node1:8001 check inter 10s fall 3 rise 2
